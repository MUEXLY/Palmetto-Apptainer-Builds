Bootstrap: docker
From: archlinux:base-devel

%files

%post
    pacman -Syu --noconfirm
    pacman -S cmake gcc boost fftw python eigen openmpi openmp wget freeglut m4 make patch gmm blas lapack hdf5 gsl fftw arpack suitesparse autoconf automake bison flex git cuda cuda-tools python-pip --noconfirm

    # add cuda path
    echo 'export PATH="/opt/cuda/bin:$PATH"' >> /environment

    # downgrad gcc version to 14, cuda does not support the latest gcc 15
    mv /usr/bin/gcc /usr/bin/gcc.bak
    mv /usr/bin/g++ /usr/bin/g++.bak
    ln -s /usr/bin/gcc-14 /usr/bin/gcc
    ln -s /usr/bin/g++-14 /usr/bin/g++
    echo 'export CC=/usr/bin/gcc-14' >> /environment
    echo 'export CXX=/usr/bin/g++-14' >> /environment

    mkdir -p python_env
    cd python_env
    python -m venv ase
    source ase/bin/activate
    pip install --upgrade ase

%runscript
